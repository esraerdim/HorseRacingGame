import{j as W,q as X,s as Y,v as Z,b as i,d as V,x as ee,_ as A,e as L,o as d,y as ne,z as te,a as u,n as ae,k as re,c as E,w as y,f as se,t as p,r as ie,h as N,l as o,i as oe,B as ue,F as le,g as de}from"./index-KlY31Qpb.js";import{u as ce}from"./useRaceState-eoamm0T4.js";import{A as pe}from"./AppPanel-CxdjstYY.js";const ve=e=>{const s=e%100;if(s>=11&&s<=13)return`${e}th Lap`;switch(e%10){case 1:return`${e}st Lap`;case 2:return`${e}nd Lap`;case 3:return`${e}rd Lap`;default:return`${e}th Lap`}},fe=()=>{const{status:e,schedule:s,currentRoundIndex:l,results:c,previewResult:g,roundSegments:_,roundStartedAt:T,roundDuration:h,roundRemaining:x,roundCompleted:F,roundCountdown:B,horseLookup:$}=ce(),v=W(Date.now());let w=null;const D=()=>{w!==null&&(cancelAnimationFrame(w),w=null)},k=()=>{v.value=Date.now(),w=requestAnimationFrame(k)};X(e,n=>{n==="running"?w===null&&k():D()}),Y(()=>{e.value==="running"&&k()}),Z(()=>{D()});const f=i(()=>{const n=s.value;if(!n.length)return null;const a=l.value;return a>=0&&a<n.length?n[a]??null:n[n.length-1]??null}),I=i(()=>{const n=c.value;return n.length?n[n.length-1]??null:null}),m=i(()=>f.value?c.value.some(n=>n.roundNumber===f.value?.roundNumber):!1),P=i(()=>{const n=h.value;if(!n)return 0;let a=F.value||0;return e.value==="running"&&T.value?a=Math.min(n,a+(v.value-T.value)):x.value!==null&&(a=n-x.value),Math.max(0,Math.min(a,n))}),q=i(()=>!B.value||B.value<0?0:Math.ceil(B.value/1e3)),z=i(()=>{const n=h.value;return!n||!f.value?e.value==="finished"?100:0:e.value==="finished"?100:Math.max(0,Math.min(100,Math.round(P.value/n*100)))}),H=(n,a)=>{if(!n||n.length===0)return Math.min(1,a/(h.value||1));const b=n[n.length-1];if(b===void 0||b<=0)return Math.min(1,a/(h.value||1));if(a>=b)return 1;let M=0,R=0;const t=1/n.length;for(let r=0;r<n.length;r+=1){const S=n[r];if(a<S){const C=a-M,Q=S-M||1;return R+t*Math.max(0,C/Q)}M=S,R+=t}return 1},G=i(()=>{const n=f.value;if(!n)return[];if(m.value&&I.value?.roundNumber===n.roundNumber&&e.value==="finished")return I.value.entries.map(t=>({id:t.horseId,name:$.value.get(t.horseId)?.name??`Horse ${t.horseId}`,positionLabel:`#${t.position}`,timeLabel:`${(t.elapsedMs/1e3).toFixed(2)} s`}));const a=g.value;if(!a)return n.horseIds.map((t,r)=>({id:t,name:$.value.get(t)?.name??`Horse ${t}`,positionLabel:`#${r+1}`}));const b=P.value,M=_.value,R=a.entries.map(t=>{const r=t.elapsedMs,S=H(M[t.horseId],b),C=b>=r;return{id:t.horseId,name:$.value.get(t.horseId)?.name??`Horse ${t.horseId}`,progressFraction:S,finishTime:r,finished:C}});return R.sort((t,r)=>t.finished&&r.finished?t.finishTime-r.finishTime:t.finished?-1:r.finished?1:r.progressFraction!==t.progressFraction?r.progressFraction-t.progressFraction:t.finishTime-r.finishTime),R.map((t,r)=>({id:t.id,name:t.name,positionLabel:`#${r+1}`,timeLabel:t.finished?`${(t.finishTime/1e3).toFixed(2)} s`:`${Math.round(t.progressFraction*(f.value?.distance??0))} m`}))}),U=i(()=>e.value==="running"?"Live":e.value==="paused"?"Paused":e.value==="countdown"?"Countdown":e.value==="awaiting"?"Awaiting":m.value?"Completed":"Upcoming"),j=i(()=>e.value==="running"?"accent":e.value==="paused"?"warning":e.value==="countdown"||e.value==="awaiting"?"info":e.value==="finished"||m.value?"success":"neutral"),J=i(()=>e.value==="running"?"accent":e.value==="paused"?"warning":e.value==="countdown"||e.value==="awaiting"?"muted":e.value==="finished"||m.value?"success":"info"),K=i(()=>e.value==="running"?"Live Leaderboard":e.value==="paused"?"Race Paused":e.value==="countdown"?"Next Lap Starting Soon":e.value==="awaiting"?"Awaiting Next Lap":m.value?"Latest Results":"Next Round Lineup"),O=i(()=>{if(!f.value)return"Awaiting race schedule";if(e.value==="running")return"Round in progress";if(e.value==="paused")return"Round paused";if(e.value==="countdown"){const n=q.value;return n>0?`Next lap starts in ${n} seconds`:"Next lap is about to start"}return e.value==="awaiting"?"Round completed – sıradaki tur hazırlanıyor":m.value?"Round completed":"Round ready to start"});return{status:e,activeRound:f,latestResult:I,hasFinishedCurrentRound:m,elapsedMs:P,progress:z,liveEntries:G,statusLabel:U,badgeTone:j,progressTone:J,title:K,subtitle:O,formatLap:ve,countdownSeconds:q}},me=V({name:"AppBadge",props:{tone:{type:String,default:"neutral"}},setup(e){const s=ee(),l=i(()=>e.tone);return{attrs:s,tone:l}}});function ge(e,s,l,c,g,_){return d(),L("span",te({class:["app-badge",`app-badge--${e.tone}`]},e.attrs),[ne(e.$slots,"default",{},void 0)],16)}const _e=A(me,[["render",ge],["__scopeId","data-v-e9db5f63"]]),he={name:"AppProgressBar",props:{value:{type:Number,default:0},tone:{type:String,default:"accent"}},setup(e){return{clampedValue:i(()=>Math.max(0,Math.min(100,e.value??0)))}}},$e=["aria-valuenow"];function be(e,s,l,c,g,_){return d(),L("div",{class:"app-progress",role:"progressbar","aria-valuenow":l.value,"aria-valuemin":"0","aria-valuemax":"100"},[u("div",{class:re(["app-progress__bar",`app-progress__bar--${l.tone}`]),style:ae({width:`${c.clampedValue}%`})},null,6)],8,$e)}const Le=A(he,[["render",be],["__scopeId","data-v-e500891f"]]),we=V({name:"LiveBoardEntry",props:{position:{type:String,required:!0},name:{type:String,required:!0},timeLabel:{type:String,default:void 0},as:{type:String,default:"li"}}}),Me={class:"live-entry__position"},Re={class:"live-entry__name"},Se={key:0,class:"live-entry__time"};function Te(e,s,l,c,g,_){return d(),E(ie(e.as),{class:"live-entry"},{default:y(()=>[u("span",Me,p(e.position),1),u("span",Re,p(e.name),1),e.timeLabel?(d(),L("span",Se,p(e.timeLabel),1)):se("",!0)]),_:1})}const xe=A(we,[["render",Te],["__scopeId","data-v-3f29dcd4"]]),Be={class:"live-board__header"},ye={class:"live-board__subtitle"},Ae={key:0,class:"live-board__empty"},Fe={key:1,class:"live-board__content"},ke={class:"live-board__meta"},Ie=V({__name:"LiveBoardPanel",setup(e){const{activeRound:s,liveEntries:l,progress:c,progressTone:g,badgeTone:_,statusLabel:T,title:h,subtitle:x,formatLap:F}=fe();return(B,$)=>(d(),E(pe,{class:"live-board",padding:"0.9rem 1rem"},{default:y(()=>[u("header",Be,[u("div",null,[u("h2",null,p(o(h)),1),u("span",ye,p(o(x)),1)]),N(_e,{class:"live-board__badge",tone:o(_)},{default:y(()=>[oe(p(o(T)),1)]),_:1},8,["tone"])]),o(s)?(d(),L("div",Fe,[u("div",ke,[u("span",null,p(o(F)(o(s).roundNumber)),1),u("span",null,p(o(s).distance)+" m",1)]),N(Le,{value:o(c),tone:o(g)},null,8,["value","tone"]),N(ue,{tag:"ul",class:"live-board__list",name:"live-board"},{default:y(()=>[(d(!0),L(le,null,de(o(l),v=>(d(),E(xe,{key:v.id,position:v.positionLabel,name:v.name,"time-label":v.timeLabel},null,8,["position","name","time-label"]))),128))]),_:1})])):(d(),L("div",Ae,[...$[0]||($[0]=[u("p",null,"Generate a race to see the live board.",-1)])]))]),_:1}))}}),Ee=A(Ie,[["__scopeId","data-v-32d92b14"]]);export{Ee as default};
