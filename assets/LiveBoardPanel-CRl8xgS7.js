import{p as O,y as Q,z as W,A as X,b as o,d as N,i as Y,_ as F,e as b,o as c,j as Z,m as ee,a as u,n as te,q as ne,c as E,w as S,f as ae,t as v,r as re,k as C,s,l as se,T as ie,F as oe,g as ue}from"./index-Org9lGqP.js";import{u as le}from"./useRaceState-C_IDJhng.js";/* empty css                                                                        *//* empty css                                                                  *//* empty css                                                                         */import{A as de}from"./AppPanel-BE5p5dOE.js";/* empty css                                                                  *//* empty css                                                                 */const ce=e=>{const i=e%100;if(i>=11&&i<=13)return`${e}th Lap`;switch(e%10){case 1:return`${e}st Lap`;case 2:return`${e}nd Lap`;case 3:return`${e}rd Lap`;default:return`${e}th Lap`}},pe=()=>{const{status:e,schedule:i,currentRoundIndex:l,results:p,previewResult:_,roundSegments:g,roundStartedAt:M,roundDuration:h,roundRemaining:A,roundCompleted:x,horseLookup:B}=le(),L=O(Date.now());let d=null;const V=()=>{d!==null&&(cancelAnimationFrame(d),d=null)},y=()=>{L.value=Date.now(),d=requestAnimationFrame(y)};Q(e,t=>{t==="running"?d===null&&y():V()}),W(()=>{e.value==="running"&&y()}),X(()=>{V()});const m=o(()=>{const t=i.value;if(!t.length)return null;const a=l.value;return a>=0&&a<t.length?t[a]??null:t[t.length-1]??null}),I=o(()=>{const t=p.value;return t.length?t[t.length-1]??null:null}),f=o(()=>m.value?p.value.some(t=>t.roundNumber===m.value?.roundNumber):!1),k=o(()=>{const t=h.value;if(!t)return 0;let a=x.value||0;return e.value==="running"&&M.value?a=Math.min(t,a+(L.value-M.value)):A.value!==null&&(a=t-A.value),Math.max(0,Math.min(a,t))}),D=o(()=>{const t=h.value;return!t||!m.value?e.value==="finished"?100:0:e.value==="finished"?100:Math.max(0,Math.min(100,Math.round(k.value/t*100)))}),q=(t,a)=>{if(!t||t.length===0)return Math.min(1,a/(h.value||1));const $=t[t.length-1];if($===void 0||$<=0)return Math.min(1,a/(h.value||1));if(a>=$)return 1;let w=0,R=0;const n=1/t.length;for(let r=0;r<t.length;r+=1){const T=t[r];if(a<T){const P=a-w,K=T-w||1;return R+n*Math.max(0,P/K)}w=T,R+=n}return 1},z=o(()=>{const t=m.value;if(!t)return[];if(f.value&&I.value?.roundNumber===t.roundNumber&&e.value==="finished")return I.value.entries.map(n=>({id:n.horseId,name:B.value.get(n.horseId)?.name??`Horse ${n.horseId}`,positionLabel:`#${n.position}`,timeLabel:`${(n.elapsedMs/1e3).toFixed(2)} s`}));const a=_.value;if(!a)return t.horseIds.map((n,r)=>({id:n,name:B.value.get(n)?.name??`Horse ${n}`,positionLabel:`#${r+1}`}));const $=k.value,w=g.value,R=a.entries.map(n=>{const r=n.elapsedMs,T=q(w[n.horseId],$),P=$>=r;return{id:n.horseId,name:B.value.get(n.horseId)?.name??`Horse ${n.horseId}`,progressFraction:T,finishTime:r,finished:P}});return R.sort((n,r)=>n.finished&&r.finished?n.finishTime-r.finishTime:n.finished?-1:r.finished?1:r.progressFraction!==n.progressFraction?r.progressFraction-n.progressFraction:n.finishTime-r.finishTime),R.map((n,r)=>({id:n.id,name:n.name,positionLabel:`#${r+1}`,timeLabel:n.finished?`${(n.finishTime/1e3).toFixed(2)} s`:`${Math.round(n.progressFraction*(m.value?.distance??0))} m`}))}),H=o(()=>e.value==="running"?"Live":e.value==="paused"?"Paused":e.value==="awaiting"?"Awaiting":f.value?"Completed":"Upcoming"),G=o(()=>e.value==="running"?"accent":e.value==="paused"?"warning":e.value==="awaiting"?"info":e.value==="finished"||f.value?"success":"neutral"),U=o(()=>e.value==="running"?"accent":e.value==="paused"?"warning":e.value==="awaiting"?"muted":e.value==="finished"||f.value?"success":"info"),j=o(()=>e.value==="running"?"Live Leaderboard":e.value==="paused"?"Race Paused":e.value==="awaiting"?"Awaiting Next Lap":f.value?"Latest Results":"Next Round Lineup"),J=o(()=>m.value?e.value==="running"?"Round in progress":e.value==="paused"?"Round paused":e.value==="awaiting"?"Round completed â€“ tap Next Lap to continue":f.value?"Round completed":"Round ready to start":"Awaiting race schedule");return{status:e,activeRound:m,latestResult:I,hasFinishedCurrentRound:f,elapsedMs:k,progress:D,liveEntries:z,statusLabel:H,badgeTone:G,progressTone:U,title:j,subtitle:J,formatLap:ce}},ve=N({name:"AppBadge",props:{tone:{type:String,default:"neutral"}},setup(e){const i=Y(),l=o(()=>e.tone);return{attrs:i,tone:l}}});function me(e,i,l,p,_,g){return c(),b("span",ee({class:["app-badge",`app-badge--${e.tone}`]},e.attrs),[Z(e.$slots,"default",{},void 0)],16)}const fe=F(ve,[["render",me],["__scopeId","data-v-5562d354"]]),_e={name:"AppProgressBar",props:{value:{type:Number,default:0},tone:{type:String,default:"accent"}},setup(e){return{clampedValue:o(()=>Math.max(0,Math.min(100,e.value??0)))}}},ge=["aria-valuenow"];function he(e,i,l,p,_,g){return c(),b("div",{class:"app-progress",role:"progressbar","aria-valuenow":l.value,"aria-valuemin":"0","aria-valuemax":"100"},[u("div",{class:ne(["app-progress__bar",`app-progress__bar--${l.tone}`]),style:te({width:`${p.clampedValue}%`})},null,6)],8,ge)}const $e=F(_e,[["render",he],["__scopeId","data-v-464edfc7"]]),be=N({name:"LiveBoardEntry",props:{position:{type:String,required:!0},name:{type:String,required:!0},timeLabel:{type:String,default:void 0},as:{type:String,default:"li"}}}),Le={class:"live-entry__position"},we={class:"live-entry__name"},Re={key:0,class:"live-entry__time"};function Te(e,i,l,p,_,g){return c(),E(re(e.as),{class:"live-entry"},{default:S(()=>[u("span",Le,v(e.position),1),u("span",we,v(e.name),1),e.timeLabel?(c(),b("span",Re,v(e.timeLabel),1)):ae("",!0)]),_:1})}const Me=F(be,[["render",Te],["__scopeId","data-v-24467295"]]),Ae={class:"live-board__header"},Be={class:"live-board__subtitle"},Se={key:0,class:"live-board__empty"},Fe={key:1,class:"live-board__content"},xe={class:"live-board__meta"},ye=N({__name:"LiveBoardPanel",setup(e){const{activeRound:i,liveEntries:l,progress:p,progressTone:_,badgeTone:g,statusLabel:M,title:h,subtitle:A,formatLap:x}=pe();return(B,L)=>(c(),E(s(de),{class:"live-board",padding:"0.9rem 1rem"},{default:S(()=>[u("header",Ae,[u("div",null,[u("h2",null,v(s(h)),1),u("span",Be,v(s(A)),1)]),C(s(fe),{class:"live-board__badge",tone:s(g)},{default:S(()=>[se(v(s(M)),1)]),_:1},8,["tone"])]),s(i)?(c(),b("div",Fe,[u("div",xe,[u("span",null,v(s(x)(s(i).roundNumber)),1),u("span",null,v(s(i).distance)+" m",1)]),C(s($e),{value:s(p),tone:s(_)},null,8,["value","tone"]),C(ie,{tag:"ul",class:"live-board__list",name:"live-board"},{default:S(()=>[(c(!0),b(oe,null,ue(s(l),d=>(c(),E(s(Me),{key:d.id,position:d.positionLabel,name:d.name,"time-label":d.timeLabel},null,8,["position","name","time-label"]))),128))]),_:1})])):(c(),b("div",Se,[...L[0]||(L[0]=[u("p",null,"Generate a race to see the live board.",-1)])]))]),_:1}))}}),qe=F(ye,[["__scopeId","data-v-b57795fa"]]);export{qe as default};
