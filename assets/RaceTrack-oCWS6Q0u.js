import{u as J}from"./useRaceState-C_IDJhng.js";import{d as q,b as s,_ as D,e as p,o as c,a as b,n as H,q as T,B as Y,t as B,k as Z,p as ee,y as ne,z as ae,A as re,R as se,f as P,s as k,F as te,g as oe,c as ue}from"./index-Org9lGqP.js";/* empty css                                                                  *//* empty css                                                                        */const ie=q({name:"RaceHorseSprite",props:{progress:{type:Number,required:!0},color:{type:String,required:!0},running:{type:Boolean,default:!1},finished:{type:Boolean,default:!1},paused:{type:Boolean,default:!1}},setup(e){const a=s(()=>e.running&&!e.finished),t=s(()=>({"race-horse--running":a.value,"race-horse--idle":!a.value,"race-horse--paused":e.paused,"race-horse--finished":e.finished})),o=s(()=>({"race-horse-wrapper--running":a.value})),f=s(()=>({"--progress":Math.min(1,Math.max(0,e.progress))}));return{horseClasses:t,wrapperClasses:o,wrapperStyle:f}}});function ce(e,a,t,o,f,m){return c(),p("div",{class:T(["race-horse-wrapper",e.wrapperClasses]),style:H(e.wrapperStyle)},[b("div",{class:T(["race-horse",e.horseClasses]),style:H({"--horse-color":e.color}),"aria-hidden":"true"},null,6)],6)}const le=D(ie,[["render",ce],["__scopeId","data-v-6c0c137f"]]),de=q({name:"RaceTrackLane",components:{RaceHorseSprite:le},props:{laneIndex:{type:Number,required:!0},name:{type:String,required:!0},progress:{type:Number,required:!0},color:{type:String,required:!0},running:{type:Boolean,default:!1},finished:{type:Boolean,default:!1},paused:{type:Boolean,default:!1}},setup(e){return{laneNumber:s(()=>e.laneIndex+1)}}}),pe={class:"race-track-lane"},fe={class:"race-track-lane__number"},me={class:"race-track-lane__track"},ge={class:"race-track-lane__label"};function ve(e,a,t,o,f,m){const g=Y("RaceHorseSprite");return c(),p("div",pe,[b("span",fe,B(e.laneNumber),1),b("div",me,[b("span",ge,B(e.name),1),Z(g,{progress:e.progress,color:e.color,running:e.running,finished:e.finished,paused:e.paused},null,8,["progress","color","running","finished","paused"])])])}const he=D(de,[["render",ve],["__scopeId","data-v-1778fbc3"]]),_e="/HorseRacingGame/assets/horse-running-DD4XUlOf.mp3",ke=(e,a,t)=>{if(!e||e.length===0)return Math.min(1,t===0?0:a/t);const o=e,f=o[o.length-1]??t;if(a>=f)return 1;let m=0,g=0;const y=1/o.length;for(let v=0;v<o.length;v+=1){const h=o[v]??t;if(a<h){const i=a-m,w=h-m||1;return g+y*Math.max(0,i/w)}m=h,g+=y}return 1},ye=e=>{const a=e%100;if(a>=11&&a<=13)return`${e}th Lap`;switch(e%10){case 1:return`${e}st Lap`;case 2:return`${e}nd Lap`;case 3:return`${e}rd Lap`;default:return`${e}th Lap`}},Re=()=>{const{status:e,schedule:a,currentRoundIndex:t,results:o,previewResult:f,roundSegments:m,roundStartedAt:g,roundDuration:y,roundRemaining:v,roundCompleted:h,horseLookup:i}=J(),w=s(()=>{const n=a.value;if(!n.length)return null;const d=n[t.value];return d||(n[n.length-1]??null)}),A=s(()=>{const n=o.value;return n.length?n[n.length-1]??null:null}),l=ee(Date.now());let L=null,_=null;const E=()=>{L!==null&&(cancelAnimationFrame(L),L=null)},C=()=>{l.value=Date.now(),L=requestAnimationFrame(C)},F=()=>{_&&(_.loop=!0,_.volume=.55,_.play().catch(()=>{}))},N=(n=!0)=>{_&&(_.pause(),n&&(_.currentTime=0))};ne(e,n=>{n==="running"?(L===null&&C(),F()):(E(),N(n!=="paused"))}),ae(()=>{_=new Audio(_e),e.value==="running"&&(C(),F())}),re(()=>{E(),N(),_=null});const V=s(()=>{const n=y.value;if(!n)return 0;let d=h.value||0;return e.value==="running"&&g.value?d=Math.min(n,d+(l.value-g.value)):v.value!==null&&(d=n-v.value),Math.max(0,Math.min(d,n))}),G=s(()=>{const n=w.value;if(!n)return[];if(e.value==="finished"&&A.value?.roundNumber===n.roundNumber){const r=new Map;return A.value.entries.forEach(u=>r.set(u.horseId,u)),n.horseIds.map((u,M)=>{const R=r.get(u),S=i.value.get(u)?.color??"#4f46e5",$=i.value.get(u)?.name??`Horse ${u}`;return R?{id:R.horseId,laneIndex:M,name:$,trackProgress:1,finished:!0,timeLabel:`${(R.elapsedMs/1e3).toFixed(2)} s`,color:S}:{id:u,laneIndex:M,name:$,trackProgress:1,finished:!0,timeLabel:"—",color:S}})}const d=f.value;if(!d)return n.horseIds.map((r,u)=>({id:r,laneIndex:u,name:i.value.get(r)?.name??`Horse ${r}`,trackProgress:0,finished:!1,timeLabel:"Ready",color:i.value.get(r)?.color??"#4f46e5"}));const x=V.value,j=m.value,z=new Map;return d.entries.forEach(r=>z.set(r.horseId,r)),n.horseIds.map((r,u)=>{const M=z.get(r),R=i.value.get(r)?.color??"#4f46e5",S=i.value.get(r)?.name??`Horse ${r}`;if(!M)return{id:r,laneIndex:u,name:S,trackProgress:0,finished:!1,timeLabel:"—",color:R};const $=M.elapsedMs,O=ke(j[r],x,$),U=x>=$,I=Math.round(O*n.distance);return{id:r,laneIndex:u,name:S,trackProgress:Math.min(1,Math.max(0,O)),finished:U,timeLabel:U?`${($/1e3).toFixed(2)} s`:`${I} m`,color:R}})}),Q=s(()=>e.value==="paused"),K=s(()=>e.value==="running"),W=s(()=>e.value==="running"?"Live":e.value==="paused"?"Paused":e.value==="awaiting"?"Awaiting":e.value==="finished"?"Finished":"Ready"),X=s(()=>e.value==="running"?"accent":e.value==="paused"?"warning":e.value==="awaiting"?"info":e.value==="finished"?"success":"neutral");return{status:e,activeRound:w,latestResult:A,runners:G,showAnimatedHorse:K,isPaused:Q,statusLabel:W,statusTone:X,formatLap:ye}},$e="/HorseRacingGame/assets/race_animation-WKQ9lyQP.mp4",we={class:"race-track"},Le=["src"],Me={key:1,class:"race-track__header"},Se={key:0,class:"race-track__lap"},be={key:1,class:"race-track__distance"},Ae={key:1,class:"race-track__placeholder"},Pe=q({__name:"RaceTrack",setup(e){const{status:a,activeRound:t,runners:o,showAnimatedHorse:f,isPaused:m,formatLap:g}=Re(),y=s(()=>Math.max(o.value.length,se)),v=s(()=>a.value==="running"),h=s(()=>t.value?`${t.value.distance}m`:null),i=s(()=>t.value?g(t.value.roundNumber):null);return(w,A)=>(c(),p("section",we,[b("div",{class:T(["race-track__inner",{"race-track__inner--idle":!v.value}])},[v.value?(c(),p("video",{key:0,class:"race-track__video",src:k($e),autoplay:"",loop:"",muted:"",playsinline:""},null,8,Le)):P("",!0),i.value||h.value?(c(),p("div",Me,[i.value?(c(),p("span",Se,B(i.value),1)):P("",!0),h.value?(c(),p("span",be,B(h.value),1)):P("",!0)])):P("",!0),(c(),p("div",{class:"race-track__track",key:k(t)?.roundNumber??"track",style:H({"--lane-count":y.value})},[k(o).length?(c(!0),p(te,{key:0},oe(k(o),l=>(c(),ue(k(he),{key:l.id,"lane-index":l.laneIndex,name:l.name,progress:l.trackProgress,color:l.color,running:k(f)&&!l.finished,finished:l.finished,paused:k(m)},null,8,["lane-index","name","progress","color","running","finished","paused"]))),128)):(c(),p("div",Ae))],4))],2)]))}}),qe=D(Pe,[["__scopeId","data-v-4eafda47"]]);export{qe as default};
