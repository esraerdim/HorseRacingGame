import{u as re}from"./useRaceState-BcZFaqvM.js";import{b as a,p as se,y as oe,z as ce,A as ue,d as q,_ as F,e as d,o as l,a as s,n as H,q as E,B as le,t as N,k as ie,R as de,f as D,s as _,F as pe,g as fe,c as ve}from"./index-D5HMm0II.js";const _e="/HorseRacingGame/assets/horse-running-DD4XUlOf.mp3",me=(e,t,o)=>{if(!e||e.length===0)return Math.min(1,o===0?0:t/o);const c=e,k=c[c.length-1]??o;if(t>=k)return 1;let w=0,p=0;const y=1/c.length;for(let R=0;R<c.length;R+=1){const M=c[R]??o;if(t<M){const m=t-w,$=M-w||1;return p+y*Math.max(0,m/$)}w=M,p+=y}return 1},ge=e=>{const t=e%100;if(t>=11&&t<=13)return`${e}th Lap`;switch(e%10){case 1:return`${e}st Lap`;case 2:return`${e}nd Lap`;case 3:return`${e}rd Lap`;default:return`${e}th Lap`}},he=()=>{const{status:e,schedule:t,currentRoundIndex:o,results:c,previewResult:k,roundSegments:w,roundStartedAt:p,roundDuration:y,roundRemaining:R,roundCompleted:M,roundCountdown:m,roundCountdownTotal:$,horseLookup:g}=re(),C=a(()=>{const n=t.value;if(!n.length)return null;const h=n[o.value];return h||(n[n.length-1]??null)}),x=a(()=>{const n=c.value;return n.length?n[n.length-1]??null:null}),L=se(Date.now());let S=null,i=null;const f=()=>{S!==null&&(cancelAnimationFrame(S),S=null)},v=()=>{L.value=Date.now(),S=requestAnimationFrame(v)},O=()=>{i&&(i.loop=!0,i.volume=.55,i.play().catch(()=>{}))},U=(n=!0)=>{i&&(i.pause(),n&&(i.currentTime=0))};oe(e,n=>{n==="running"?(S===null&&v(),O()):(f(),U(n!=="paused"))}),ce(()=>{i=new Audio(_e),e.value==="running"&&(v(),O())}),ue(()=>{f(),U(),i=null});const Q=a(()=>{const n=y.value;if(!n)return 0;let h=M.value||0;return e.value==="running"&&p.value?h=Math.min(n,h+(L.value-p.value)):R.value!==null&&(h=n-R.value),Math.max(0,Math.min(h,n))}),K=a(()=>{const n=C.value;if(!n)return[];if(e.value==="countdown")return[];if(e.value==="finished"&&x.value?.roundNumber===n.roundNumber){const r=new Map;return x.value.entries.forEach(u=>r.set(u.horseId,u)),n.horseIds.map((u,A)=>{const b=r.get(u),T=g.value.get(u)?.color??"#4f46e5",P=g.value.get(u)?.name??`Horse ${u}`;return b?{id:b.horseId,laneIndex:A,name:P,trackProgress:1,finished:!0,timeLabel:`${(b.elapsedMs/1e3).toFixed(2)} s`,color:T}:{id:u,laneIndex:A,name:P,trackProgress:1,finished:!0,timeLabel:"—",color:T}})}const h=k.value;if(!h)return n.horseIds.map((r,u)=>({id:r,laneIndex:u,name:g.value.get(r)?.name??`Horse ${r}`,trackProgress:0,finished:!1,timeLabel:"Ready",color:g.value.get(r)?.color??"#4f46e5"}));const G=Q.value,ae=w.value,I=new Map;return h.entries.forEach(r=>I.set(r.horseId,r)),n.horseIds.map((r,u)=>{const A=I.get(r),b=g.value.get(r)?.color??"#4f46e5",T=g.value.get(r)?.name??`Horse ${r}`;if(!A)return{id:r,laneIndex:u,name:T,trackProgress:0,finished:!1,timeLabel:"—",color:b};const P=A.elapsedMs,z=me(ae[r],G,P),V=G>=P,te=Math.round(z*n.distance);return{id:r,laneIndex:u,name:T,trackProgress:Math.min(1,Math.max(0,z)),finished:V,timeLabel:V?`${(P/1e3).toFixed(2)} s`:`${te} m`,color:b}})}),X=a(()=>e.value==="paused"),j=a(()=>e.value==="running"),J=a(()=>e.value==="countdown"),Y=a(()=>!m.value||m.value<0?0:Math.ceil(m.value/1e3)),Z=a(()=>{if(!m.value||m.value<0||!$.value||$.value<=0)return 0;const n=m.value/$.value;return Math.max(0,Math.min(1,n))}),ee=a(()=>e.value==="running"?"Live":e.value==="paused"?"Paused":e.value==="countdown"?"Countdown":e.value==="awaiting"?"Awaiting":e.value==="finished"?"Finished":"Ready"),ne=a(()=>e.value==="running"?"accent":e.value==="paused"?"warning":e.value==="countdown"||e.value==="awaiting"?"info":e.value==="finished"?"success":"neutral");return{status:e,activeRound:C,latestResult:x,runners:K,showAnimatedHorse:j,isPaused:X,isCountdown:J,countdownSeconds:Y,countdownProgress:Z,statusLabel:ee,statusTone:ne,formatLap:ge}},ke=q({name:"RaceHorseSprite",props:{progress:{type:Number,required:!0},color:{type:String,required:!0},running:{type:Boolean,default:!1},finished:{type:Boolean,default:!1},paused:{type:Boolean,default:!1}},setup(e){const t=a(()=>e.running&&!e.finished),o=a(()=>({"race-horse--running":t.value,"race-horse--idle":!t.value,"race-horse--paused":e.paused,"race-horse--finished":e.finished})),c=a(()=>({"race-horse-wrapper--running":t.value})),k=a(()=>({"--progress":Math.min(1,Math.max(0,e.progress))}));return{horseClasses:o,wrapperClasses:c,wrapperStyle:k}}});function we(e,t,o,c,k,w){return l(),d("div",{class:E(["race-horse-wrapper",e.wrapperClasses]),style:H(e.wrapperStyle)},[s("div",{class:E(["race-horse",e.horseClasses]),style:H({"--horse-color":e.color}),"aria-hidden":"true"},null,6)],6)}const ye=F(ke,[["render",we],["__scopeId","data-v-4caac8c8"]]),Re=q({name:"RaceTrackLane",components:{RaceHorseSprite:ye},props:{laneIndex:{type:Number,required:!0},name:{type:String,required:!0},progress:{type:Number,required:!0},color:{type:String,required:!0},running:{type:Boolean,default:!1},finished:{type:Boolean,default:!1},paused:{type:Boolean,default:!1}},setup(e){return{laneNumber:a(()=>e.laneIndex+1)}}}),$e={class:"race-track-lane"},Me={class:"race-track-lane__number"},Se={class:"race-track-lane__track"},Ce={class:"race-track-lane__label"};function Le(e,t,o,c,k,w){const p=le("RaceHorseSprite");return l(),d("div",$e,[s("span",Me,N(e.laneNumber),1),s("div",Se,[s("span",Ce,N(e.name),1),ie(p,{progress:e.progress,color:e.color,running:e.running,finished:e.finished,paused:e.paused},null,8,["progress","color","running","finished","paused"])])])}const be=F(Re,[["render",Le],["__scopeId","data-v-4f85836f"]]),Pe="/HorseRacingGame/assets/race_animation-WKQ9lyQP.mp4",xe={class:"race-track"},Ae=["src"],Te={key:1,class:"race-track__header"},De={key:0,class:"race-track__lap"},Ne={key:1,class:"race-track__distance"},Be={key:2,class:"race-track__countdown"},He={class:"race-track__countdown-ring"},Ee={class:"race-track__countdown-svg",viewBox:"0 0 180 180",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},qe=["stroke-dashoffset"],Fe={class:"race-track__countdown-text"},Oe={class:"race-track__countdown-value"},Ue={key:1,class:"race-track__placeholder"},B=70,W="race-track-countdown-gradient",Ge=q({__name:"RaceTrack",setup(e){const{status:t,activeRound:o,runners:c,showAnimatedHorse:k,isPaused:w,isCountdown:p,countdownSeconds:y,countdownProgress:R,formatLap:M}=he(),m=a(()=>Math.max(c.value.length,de)),$=a(()=>t.value==="running"),g=a(()=>o.value?`${o.value.distance}m`:null),C=a(()=>o.value?M(o.value.roundNumber):null),x=`url(#${W})`,L=2*Math.PI*B,S=a(()=>{if(!p.value)return L;const i=Math.max(0,Math.min(1,R.value));return L*(1-i)});return(i,f)=>(l(),d("section",xe,[s("div",{class:E(["race-track__inner",{"race-track__inner--idle":!$.value}])},[$.value?(l(),d("video",{key:0,class:"race-track__video",src:_(Pe),autoplay:"",loop:"",muted:"",playsinline:""},null,8,Ae)):D("",!0),(!_(p)||_(y)<=0)&&(C.value||g.value)?(l(),d("div",Te,[C.value?(l(),d("span",De,N(C.value),1)):D("",!0),g.value?(l(),d("span",Ne,N(g.value),1)):D("",!0)])):D("",!0),_(p)&&_(y)>0?(l(),d("div",Be,[s("div",He,[(l(),d("svg",Ee,[s("defs",null,[s("linearGradient",{id:W,x1:"0%",y1:"0%",x2:"100%",y2:"100%"},[...f[0]||(f[0]=[s("stop",{offset:"0%","stop-color":"#a855f7"},null,-1),s("stop",{offset:"100%","stop-color":"#4338ca"},null,-1)])])]),s("circle",{class:"race-track__countdown-circle race-track__countdown-circle--base",cx:"90",cy:"90",r:B}),s("circle",{class:"race-track__countdown-circle race-track__countdown-circle--progress",cx:"90",cy:"90",r:B,"stroke-dasharray":L,"stroke-dashoffset":S.value,stroke:x,transform:"rotate(-90 90 90)"},null,8,qe)])),s("div",Fe,[f[1]||(f[1]=s("span",{class:"race-track__countdown-label"},"Next race",-1)),f[2]||(f[2]=s("span",{class:"race-track__countdown-label"},"starts in",-1)),s("span",Oe,N(_(y)),1),f[3]||(f[3]=s("span",{class:"race-track__countdown-label-secondary"},"seconds",-1))])])])):D("",!0),(l(),d("div",{class:"race-track__track",key:_(o)?.roundNumber??"track",style:H({"--lane-count":m.value})},[_(c).length?(l(!0),d(pe,{key:0},fe(_(c),v=>(l(),ve(be,{key:v.id,"lane-index":v.laneIndex,name:v.name,progress:v.trackProgress,color:v.color,running:_(k)&&!v.finished,finished:v.finished,paused:_(w)},null,8,["lane-index","name","progress","color","running","finished","paused"]))),128)):(l(),d("div",Ue))],4))],2)]))}}),Ve=F(Ge,[["__scopeId","data-v-d6cea605"]]);export{Ve as default};
